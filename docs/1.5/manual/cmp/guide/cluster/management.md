# 集群管理

## 添加集群

完成 [组织创建](../../../quick-start/newbie.html#加入组织) 等基本工作后，您需要添加集群以便后续完整使用平台核心功能。

您可以通过以下方式添加集群：

* 一键创建集群
* 导入自建的 Kubernetes 集群
* 通过 Erda 工具链手动创建集群

### 一键创建集群

Erda 支持一键创建以下三种类型的集群：

* 阿里云容器服务集群（托管版）
* 阿里云容器服务集群（专有版）
* 自建集群

![](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2022/01/10/853eab96-d0be-4e83-b52d-b1ca8e70dda7.png)

若添加阿里云容器服务集群，您需在创建集群前，进入 **多云管理平台 > 资源管理 > 云资源管理 > 云账户** 添加阿里云账号（包含阿里云容器服务相关权限），以便后台购买阿里云容器服务集群及创建环境。

若通过自建集群方式构建，您需直接提供已有 IT 资源信息，后台将通过提供的资源创建集群。

### 导入已创建的集群

Erda 要求导入的集群满足相关条件，具体请参见 [安装要求](../../../install/helm-install/premise.md#安装要求)。导入集群前，您需要对集群进行一些简单的配置，具体请参见 [准备工作](../../../install/helm-install/premise.md#准备工作)。

Erda 提供三种导入自建 Kubernetes 集群的方式：

- KubeConfig
- Service Account
- Cluster Agent

:::tip 提示

集群导入后，Erda 会对您的集群进行初始化，部署 Erda 组件及相关依赖。

:::

请进入 **多云管理平台 > 资源管理 > 集群管理 > 添加集群 > Kubernetes（导入已创建的 Erda Kubernetes 集群）** 操作。

![](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2022/01/10/fb618855-d003-4776-814f-aa9637aa96cd.png)

* **KubeConfig 和 Service Account**：适用于集群有开放 API Server 端口的场景。
* **Cluster Agent**：适用于集群无开放 API Server 端口的场景。

::: tip 提示
完成集群创建后，需将集群与具体项目绑定后才可使用。请进入 **管理中心 > 项目管理 > 选择对应项目 > 集群设置** 进行操作。
:::

## 验证集群状态

您可以通过以下方式验证集群的运行状态：

* 进入 **多云管理平台 > 集群总览**。
  理想状态下，可查看导入的集群信息、机器列表等，可覆盖常规的监控功能。
* 进入 **多云管理平台 > 资源管理 > 集群管理**。
  理想状态下，可查看集群的基本信息，例如机器类型、版本、LB/Master 数量等。
* [CI/CD](../../../dop/guides/deploy/deploy-by-cicd-pipeline.md) 主流程验证。

## 修改集群配置
完成集群创建后，可根据实际情况修改集群配置，一般多为修改超卖比。

当前超卖比主要针对 CPU 资源设置。若超卖比设为 2，相当于 1 核 CPU 用作 2 核，即当请求 1 核 CPU 时，实际初次配置仅有 0.5 核，仅将使用上限设置为 1 核。修改超卖比配置时，需注意如下事项：

* 超卖比仅针对 CPU 资源超卖。
* 不建议在生产环境使用超卖比，以节省 CPU 资源。
* 请勿在使用过程中修改超卖比，以免影响项目可用资源显示。

## 升级集群
集群升级主要针对中心集群管理的边缘集群，使其版本与中心集群保持一致。集群升级需注意以下事项：

* 升级需由运维人员统一操作，一般用户无需升级。
* 仅升级边缘 SaaS 化集群。
* 仅升级较低版本的边缘集群。

## 下线集群
平台支持在线集群的回收释放。请进入 **多云管理平台 > 资源管理 > 集群管理 > 操作** 下线集群。

为避免影响在线业务，集群释放下线前需完成以下工作：

* 清理所有运行在该集群上的项目应用运行时 Runtime。
* 清理所有运行在该集群上的项目中间件 Addon。
* 修改集群设置，清理所有项目对该集群的引用。请进入 **管理中心 > 项目管理 > 选择项目 > 集群设置** 进行操作。

::: tip 提示

集群下线并非销毁集群，只是将集群从平台释放不再纳管进行调度使用，实际的集群资源仍然存在。如需销毁，则需手动关闭所有的机器资源。

:::

# 为接口设置读写超时和传输限制

## 流量入口 API 策略设置

可以通过流量入口下的 API 策略进行配置。

具体操作路径如下：

- 全局策略：进入 **微服务治理平台 > 项目列表 > 选择项目 > API 网关 > 流量入口管理**，选择对应的流量入口，点击 **详情 > 全局策略 > 业务策略 > 流量接收转发**。
- 具体 API 策略：进入 **微服务治理平台 > 项目列表 > 选择项目 > API 网关 > 流量入口管理**，选择对应的流量入口，点击 **详情** 后选择对应的 API，点击 **策略 > 业务策略 > 流量接收转发**。

### 示例一

若需求为：

- 允许客户端请求方在发送请求的过程中，至多 100 秒内没有响应
- 允许后端服务在响应应答的过程中，至多 300 秒内没有响应

则配置如图红框所示，点击确定立即生效

![](https://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/10/20/a3a384c2-a378-4523-86ca-8d62da077477.png)

:::warning 后端应答超时时间不应过大

理由一：配置过大的后端应答超时时间，会在高并发流量下，因为后端服务的性能问题，导致维持大量的连接，最终影响网关的可用性

理由二：在使用了云厂商的 SLB 服务时，通常会限制后端响应超时小于 90 秒，即使调高了 API 网关的超时限制，也会因为云厂商 SLB 的限制，导致最终返回 504

后端响应时间过长，根据不同场景，一般可以通过两种方式优化：
1. 业务流程过于复杂导致的超时：进行业务流程的异步化改造
2. 传输内容过大导致的超时：一般是后端再次转发请求时没有开启流式传输导致，比如接收请求后再上传 oss 的场景没有使用流式传输

:::

### 示例二

若需求为：

- 允许客户端请求方，上传 500 MB 以内的文件

则配置如图红框所示，点击确定立即生效

![](https://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/10/20/fd33282e-c6c0-4e37-a575-95e193fe93cd.png)



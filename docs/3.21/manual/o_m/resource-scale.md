# 扩缩容

Dice 平台是一个云平台，它是以 [集群](../platform-design.md#集群) 的方式提供服务，所有的业务和管理服务都是运行在 Node 节点上，随着业务的不断变化（ 扩展或者消亡 ），对于 Node 节点提供的服务需求也会不断变化，这时就需要动态对 Node 节点进行增删管理，也就是本文接下来要介绍的集群扩缩容内容。

以下场景的时候需要对集群进行扩缩容：

- 新建平台创建第一个集群。
- 环境隔离性考虑或者特殊场景的需要独立集群的时候，从而需要单独再创建集群。
- 随着业务的发展，当前集群 Node 节点资源不足以支撑业务需要，需要追加节点机器。
- 集群整体释放，或者节点使用率不高，希望减少节点来缩减成本。

接下来就重点介绍一下扩容中涉及到的集群创建、节点机器追加的内容，以及缩容中的节点机器的删除和集群删除的内容。

## 创建集群

创建集群就是完全新建一个集群，具体创建的方法请参考[新建集群](create-cluster.md)。

::: tip
集群创建完之后，还需要继续添加业务机器，才真正有业务资源能被项目正常调度使用。
:::

## 添加机器

当集群创建完成后，接下来就需要在集群中添加机器资源来提供业务服务调度使用了，添加机器可以通过在线页面向导式操作完成，添加机器可以是新物理机器或已有物理机器，也可以是新虚拟机或已有虚拟机（包含云主机），平台支持机器对象可以参考[多云管理平台](../production-intro.md#多云管理)。

在线添加机器页面入口：

> 多云管理平台 -> 集群管理 -> 选择集群进行操作。

为了更灵活调度和管理机器，集群机器还支持标签管理，在添加机器时可以设置合理的标签进行灵活管理，具体标签设置方法可以参考[节点标签设置](node-labels.md)。

## 释放集群

有扩容就有缩容，平台支持在线集群创建功能的同时，也支持了在线集群回收释放的功能。为了释放集群的时候不会影响在线业务，在集群释放下线前，需要先完成以下准备工作：

- 清理所有运行在该集群上的项目应用 [runtime](../platform-design.md#服务和-runtime)

- 清理所有运行在该集群上的项目 [addon](../addon/README.md)

- 修改所有项目的集群设置，清理所有项目对该集群的引用。

  项目集群设置入口位于：

  > 企业中心 -> 项目管理 -> 选择项目 -> 集群设置。

注意：集群下线并不会真正意义上销毁集群，只是将集群从平台释放不再纳管进行调度使用，实际的集群资源还在，如果需要真正销毁需要手动关闭所有的机器资源。

集群下线的入口位于：

> 多云管理平台 -> 集群管理 -> 选择集群 -> 集群下线。

## 缩减机器

平台支持在线进行机器下线的操作，在机器正式下线前需要完成以下事前准备工作：

- 为防止业务影响和业务数据的丢失，需要下线的机器上不能有 [addon](../addons/README.md) 服务还运行着，如有需要手动进行迁移后才能进行下线。
- 关键功能运行的节点不能下线，具体包含 lb 、cassandra、es、kafka、nexus、gittar 标签的宿主机。

机器下线的入口位于：

> 多云管理平台 -> 集群总览 -> 选择节点 -> 下线。

